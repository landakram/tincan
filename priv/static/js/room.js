// Generated by CoffeeScript 1.6.3
(function() {
  var Room;

  Room = (function() {
    Room.messageTemplate = "<li class='message'>" + "<span class='date'><%= new Date().toLocaleTimeString() %>:</span>" + " <span class='message-text'><%- message %></span>" + "</li>";

    function Room(roomName) {
      var _this = this;
      this.roomName = roomName;
      this.messageTemplate = _.template(Room.messageTemplate);
      $('#send-form').on('submit', function(e) {
        var data;
        e.preventDefault();
        if ($('#message-input').val()) {
          data = $('#send-form').serialize();
          $.post("/" + roomName + "/send", data);
          return $('input[name="message"]').val("");
        }
      });
      this.listen();
    }

    Room.prototype.listen = function() {
      var _this = this;
      this.source = new EventSource("/" + this.roomName + "/stream");
      return this.source.addEventListener('message', function(event) {
        return _this.renderMessage(event.data);
      }, false);
    };

    Room.prototype.renderMessage = function(message) {
      var $message;
      $message = $(this.messageTemplate({
        message: message
      }));
      return $message.prependTo('#message-list');
    };

    return Room;

  })();

  $('document').ready(function() {
    var room, roomName;
    roomName = location.href.substr(location.href.lastIndexOf('/') + 1);
    return room = new Room(roomName);
  });

}).call(this);
